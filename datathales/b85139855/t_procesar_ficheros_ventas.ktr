<?xml version="1.0" encoding="UTF-8"?>
<transformation>
  <info>
    <name>t_procesar_ficheros_ventas</name>
    <description/>
    <extended_description/>
    <trans_version>1.0</trans_version>
    <trans_status>2</trans_status>
    <directory>&#47;</directory>
    <parameters>
    </parameters>
    <log>
      <read/>
      <write/>
      <input/>
      <output/>
      <update/>
      <rejected/>
      <connection>datathales</connection>
      <table>talend_tra_log</table>
      <step_performance_table/>
      <use_batchid>Y</use_batchid>
      <use_logfield>N</use_logfield>
      <size_limit_lines/>
    </log>
    <maxdate>
      <connection/>
      <table/>
      <field/>
      <offset>0.0</offset>
      <maxdiff>0.0</maxdiff>
    </maxdate>
    <size_rowset>10000</size_rowset>
    <sleep_time_empty>50</sleep_time_empty>
    <sleep_time_full>50</sleep_time_full>
    <unique_connections>Y</unique_connections>
    <feedback_shown>Y</feedback_shown>
    <feedback_size>50000</feedback_size>
    <using_thread_priorities>Y</using_thread_priorities>
    <shared_objects_file/>
    <capture_step_performance>N</capture_step_performance>
    <step_performance_capturing_delay>1000</step_performance_capturing_delay>
    <dependencies>
    </dependencies>
    <partitionschemas>
    </partitionschemas>
    <slaveservers>
    </slaveservers>
    <clusterschemas>
    </clusterschemas>
  <modified_user>admin</modified_user>
  <modified_date>2010&#47;09&#47;29 17:45:07.725</modified_date>
  </info>
  <notepads>
    <notepad>
      <note>Se leen los ficheros del directorio q se pasa por parametros:
Se insertan las líneas en un fichero temporal para poderlas procesar como sigue:

1.- Si es un tick -&gt; se divide el flujo en dos, en el flujo a) se busca en la tabla ticket_superior_dia,
	por si ya se ha procesado esta venta, si es así se actualiza el chek actualizado a cero para q
	en un siguiente proceso al estar a cero se pueda volver a cargar, si no existe se crea.
	En el flujo b), se hace un distinct sobre todas las lineas para dejar una sola por tienda y dia.
	Tras esto se construyen las rutas donde se dejaran los ficheros (por parametro), luego se 
	leen todas las lineas de ticket de esa tienda-dia y se crea el nuevo fichero en la nueva ruta.
	
2.- Si es un ofe -&gt; Igual que el flujo b) de los tick (Este fichero contiene las ofertas)
3.- Si es un imp -&gt; Igual que el flujo b) de los tick (Este fichero contiene los dto% empleados)</note>
      <xloc>91</xloc>
      <yloc>724</yloc>
      <width>576</width>
      <heigth>187</heigth>
    </notepad>
    <notepad>
      <note>&#47;&#47;La subquery calcula los numero de cierre (campo tpv) en los cuales hay lineas con 2 fechas o mas distintas. 
&#47;&#47;Luego se consulta el nombre de fichero, fecha, tienda de la tabla temporal para los cierres que NO tengan mas de 2 fechas </note>
      <xloc>889</xloc>
      <yloc>585</yloc>
      <width>728</width>
      <heigth>39</heigth>
    </notepad>
    <notepad>
      <note>&#47;&#47;La subquery calcula los numero de cierre (campo tpv) en los cuales hay lineas con 2 fechas o mas distintas. 
&#47;&#47;Luego se consulta el nombre de fichero, fecha, tienda de la tabla temporal para los cierres que  tengan mas de 2 fechas </note>
      <xloc>884</xloc>
      <yloc>712</yloc>
      <width>709</width>
      <heigth>39</heigth>
    </notepad>
  </notepads>
  <connection>
    <name>datathales</name>
    <server>${ip_servidor}</server>
    <type>POSTGRESQL</type>
    <access>Native</access>
    <database>${bd_servidor}</database>
    <port>${bd_puerto}</port>
    <username>${bd_usuario}</username>
    <password>${bd_password}</password>
    <servername/>
    <data_tablespace/>
    <index_tablespace/>
    <attributes>
      <attribute><code>FORCE_IDENTIFIERS_TO_LOWERCASE</code><attribute>N</attribute></attribute>
      <attribute><code>FORCE_IDENTIFIERS_TO_UPPERCASE</code><attribute>N</attribute></attribute>
      <attribute><code>IS_CLUSTERED</code><attribute>N</attribute></attribute>
      <attribute><code>PORT_NUMBER</code><attribute>${bd_puerto}</attribute></attribute>
      <attribute><code>QUOTE_ALL_FIELDS</code><attribute>N</attribute></attribute>
      <attribute><code>SUPPORTS_BOOLEAN_DATA_TYPE</code><attribute>N</attribute></attribute>
      <attribute><code>USE_POOLING</code><attribute>N</attribute></attribute>
    </attributes>
  </connection>
  <order>
  <hop> <from>creo_campo_tipo_fichero</from><to>que_tipo_fichero?</to><enabled>Y</enabled> </hop>  <hop> <from>busca_lineas_OFE</from><to>fichero_a_incorporar_OFE</to><enabled>Y</enabled> </hop>  <hop> <from>busca_lineas_TIC</from><to>fichero_a_incorporar_TIC</to><enabled>Y</enabled> </hop>  <hop> <from>Paso de Bloqueo tick</from><to>busca_ficheros_TIC_en_tablas</to><enabled>Y</enabled> </hop>  <hop> <from>busca_ficheros_OFE_en_tablas</from><to>creo_rutas_ficheros_ofe</to><enabled>Y</enabled> </hop>  <hop> <from>busca_ficheros_TIC_en_tablas</from><to>creo_rutas_ficheros_tic</to><enabled>Y</enabled> </hop>  <hop> <from>creo_rutas_ficheros_tic</from><to>busca_lineas_TIC</to><enabled>Y</enabled> </hop>  <hop> <from>creo_rutas_ficheros_ofe</from><to>busca_lineas_OFE</to><enabled>Y</enabled> </hop>  <hop> <from>secuencia_fichero_tick</from><to>prepara_campos_segun_tipo_registro</to><enabled>Y</enabled> </hop>  <hop> <from>OFE</from><to>secuencia_fichero_ofe</to><enabled>Y</enabled> </hop>  <hop> <from>que_tipo_fichero?</from><to>TICK</to><enabled>Y</enabled> </hop>  <hop> <from>que_tipo_fichero?</from><to>OFE</to><enabled>Y</enabled> </hop>  <hop> <from>Paso de Bloqueo tick</from><to>Busco tienda, fecha,tpv en tablas</to><enabled>N</enabled> </hop>  <hop> <from>Busco tienda, fecha,tpv en tablas</from><to>Selecciona&#47;Renombra valores</to><enabled>N</enabled> </hop>  <hop> <from>Paso de Bloqueo ofe</from><to>busca_ficheros_OFE_en_tablas</to><enabled>Y</enabled> </hop>  <hop> <from>TICK</from><to>secuencia_fichero_tick</to><enabled>Y</enabled> </hop>  <hop> <from>Obtener nombres de fichero</from><to>Quito campos que no se usan</to><enabled>Y</enabled> </hop>  <hop> <from>Quito campos que no se usan</from><to>creo_campo_tipo_fichero</to><enabled>Y</enabled> </hop>  <hop> <from>secuencia_fichero_ofe</from><to>Inserta Ofe</to><enabled>Y</enabled> </hop>  <hop> <from>Inserta Ofe</from><to>Paso de Bloqueo ofe</to><enabled>Y</enabled> </hop>  <hop> <from>prepara_campos_segun_tipo_registro</from><to>Inserta Tick</to><enabled>Y</enabled> </hop>  <hop> <from>Inserta Tick</from><to>Paso de Bloqueo tick</to><enabled>Y</enabled> </hop>  <hop> <from>Selecciona&#47;Renombra valores</from><to>fecha_ultimo_cambio</to><enabled>N</enabled> </hop>  <hop> <from>fecha_ultimo_cambio</from><to>Insertar en f_ticket_superior_dia</to><enabled>N</enabled> </hop>  <hop> <from>ARTI</from><to>secuencia_fichero_arti</to><enabled>Y</enabled> </hop>  <hop> <from>Inserta Arti</from><to>Paso de Bloqueo arti</to><enabled>Y</enabled> </hop>  <hop> <from>Paso de Bloqueo arti</from><to>busca_ficheros_ARTI_en_tablas</to><enabled>Y</enabled> </hop>  <hop> <from>busca_ficheros_ARTI_en_tablas</from><to>creo_rutas_ficheros_arti</to><enabled>Y</enabled> </hop>  <hop> <from>busca_lineas_arti</from><to>fichero_a_incorporar</to><enabled>Y</enabled> </hop>  <hop> <from>creo_rutas_ficheros_arti</from><to>busca_lineas_arti</to><enabled>Y</enabled> </hop>  <hop> <from>prepara_campos_arti</from><to>Inserta Arti</to><enabled>Y</enabled> </hop>  <hop> <from>secuencia_fichero_arti</from><to>prepara_campos_arti</to><enabled>Y</enabled> </hop>  <hop> <from>que_tipo_fichero?</from><to>ARTI</to><enabled>Y</enabled> </hop>  <hop> <from>Añadir campos mail</from><to>Mail</to><enabled>Y</enabled> </hop>  <hop> <from>FICHERO_TMP_PARA_EMAIL</from><to>Paso de Bloqueo para mail</to><enabled>Y</enabled> </hop>  <hop> <from>Paso de Bloqueo para mail</from><to>Switch &#47; Case</to><enabled>Y</enabled> </hop>  <hop> <from>Switch &#47; Case</from><to>Añadir campos mail</to><enabled>Y</enabled> </hop>  <hop> <from>Switch &#47; Case</from><to>FIN</to><enabled>Y</enabled> </hop>  <hop> <from>cierres_con_2_fechas_o_mas</from><to>FICHERO_TMP_PARA_EMAIL</to><enabled>Y</enabled> </hop>  <hop> <from>cierres_con_2_fechas_o_mas</from><to>LOG_CIERRES_ACUMULADOS</to><enabled>Y</enabled> </hop>  <hop> <from>Paso de Bloqueo arti</from><to>cierres_con_2_fechas_o_mas</to><enabled>Y</enabled> </hop>  <hop> <from>busca_lineas_arti 2</from><to>fichero_a_incorporar 2</to><enabled>Y</enabled> </hop>  <hop> <from>creo_rutas_ficheros_arti 2</from><to>busca_lineas_arti 2</to><enabled>Y</enabled> </hop>  <hop> <from>cierres_con_2_fechas_o_mas</from><to>creo_rutas_ficheros_arti 2</to><enabled>Y</enabled> </hop>  </order>
  <step>
    <name>ARTI</name>
    <type>TextFileInput</type>
    <description/>
    <distribute>N</distribute>
    <copies>1</copies>
         <partitioning>
           <method>none</method>
           <schema_name/>
           </partitioning>
    <accept_filenames>Y</accept_filenames>
    <passing_through_fields>Y</passing_through_fields>
    <accept_field>filename</accept_field>
    <accept_stepname>que_tipo_fichero?</accept_stepname>
    <separator/>
    <enclosure/>
    <enclosure_breaks>N</enclosure_breaks>
    <escapechar/>
    <header>N</header>
    <nr_headerlines>1</nr_headerlines>
    <footer>N</footer>
    <nr_footerlines>1</nr_footerlines>
    <line_wrapped>N</line_wrapped>
    <nr_wraps>1</nr_wraps>
    <layout_paged>N</layout_paged>
    <nr_lines_per_page>80</nr_lines_per_page>
    <nr_lines_doc_header>0</nr_lines_doc_header>
    <noempty>Y</noempty>
    <include>N</include>
    <include_field/>
    <rownum>N</rownum>
    <rownumByFile>N</rownumByFile>
    <rownum_field/>
    <format>DOS</format>
    <encoding/>
    <add_to_result_filenames>Y</add_to_result_filenames>
    <file>
      <name/>
      <filemask/>
      <file_required>N</file_required>
      <type>Fixed</type>
      <compression>None</compression>
    </file>
    <filters>
    </filters>
    <fields>
      <field>
        <name>linea_fichero</name>
        <type>String</type>
        <format/>
        <currency/>
        <decimal/>
        <group/>
        <nullif/>
        <ifnull/>
        <position>0</position>
        <length>261</length>
        <precision>-1</precision>
        <trim_type>right</trim_type>
        <repeat>N</repeat>
      </field>
    </fields>
    <limit>0</limit>
    <error_ignored>N</error_ignored>
    <error_line_skipped>N</error_line_skipped>
    <error_count_field/>
    <error_fields_field/>
    <error_text_field/>
    <bad_line_files_destination_directory/>
    <bad_line_files_extension>warning</bad_line_files_extension>
    <error_line_files_destination_directory/>
    <error_line_files_extension>error</error_line_files_extension>
    <line_number_files_destination_directory/>
    <line_number_files_extension>line</line_number_files_extension>
    <date_format_lenient>Y</date_format_lenient>
    <date_format_locale>es_es</date_format_locale>
     <cluster_schema/>
 <remotesteps>   <input>   </input>   <output>   </output> </remotesteps>    <GUI>
      <xloc>259</xloc>
      <yloc>508</yloc>
      <draw>Y</draw>
      </GUI>
    </step>

  <step>
    <name>Añadir campos mail</name>
    <type>Constant</type>
    <description/>
    <distribute>Y</distribute>
    <copies>1</copies>
         <partitioning>
           <method>none</method>
           <schema_name/>
           </partitioning>
    <fields>
      <field>
        <name>dirDestino</name>
        <type>String</type>
        <format/>
        <currency/>
        <decimal/>
        <group/>
        <nullif>informatica@hiperusera.es</nullif>
        <length>-1</length>
        <precision>-1</precision>
      </field>
      <field>
        <name>nombreOrig</name>
        <type>String</type>
        <format/>
        <currency/>
        <decimal/>
        <group/>
        <nullif>root</nullif>
        <length>-1</length>
        <precision>-1</precision>
      </field>
      <field>
        <name>dirOrig</name>
        <type>String</type>
        <format/>
        <currency/>
        <decimal/>
        <group/>
        <nullif>informatica@hiperusera.es</nullif>
        <length>-1</length>
        <precision>-1</precision>
      </field>
      <field>
        <name>smtpServer</name>
        <type>String</type>
        <format/>
        <currency/>
        <decimal/>
        <group/>
        <nullif>smtp.hiperusera.es</nullif>
        <length>-1</length>
        <precision>-1</precision>
      </field>
      <field>
        <name>smtpPort</name>
        <type>Integer</type>
        <format/>
        <currency/>
        <decimal/>
        <group/>
        <nullif>25</nullif>
        <length>-1</length>
        <precision>-1</precision>
      </field>
      <field>
        <name>mailSubject</name>
        <type>String</type>
        <format/>
        <currency/>
        <decimal/>
        <group/>
        <nullif>TAREA ARTIVEN: REPROCESAR TIENDAS</nullif>
        <length>-1</length>
        <precision>-1</precision>
      </field>
      <field>
        <name>authUsername</name>
        <type>String</type>
        <format/>
        <currency/>
        <decimal/>
        <group/>
        <nullif>ndd377c</nullif>
        <length>-1</length>
        <precision>-1</precision>
      </field>
      <field>
        <name>authPass</name>
        <type>String</type>
        <format/>
        <currency/>
        <decimal/>
        <group/>
        <nullif>Inf2009</nullif>
        <length>-1</length>
        <precision>-1</precision>
      </field>
    </fields>
     <cluster_schema/>
 <remotesteps>   <input>   </input>   <output>   </output> </remotesteps>    <GUI>
      <xloc>1252</xloc>
      <yloc>785</yloc>
      <draw>Y</draw>
      </GUI>
    </step>

  <step>
    <name>Busco tienda, fecha,tpv en tablas</name>
    <type>DBJoin</type>
    <description/>
    <distribute>N</distribute>
    <copies>1</copies>
         <partitioning>
           <method>none</method>
           <schema_name/>
           </partitioning>
    <connection>datathales</connection>
    <rowlimit>0</rowlimit>
    <sql>select distinct fecha as fecha_tabla, tienda as tienda_tabla, tpv as tpv_tabla, 0 as cero from tmp_filtra_fich_ventas 
where tipo_reg=&apos;001&apos; and  fecha !=&apos;&apos; order by fecha, tienda, tpv</sql>
    <outer_join>N</outer_join>
    <replace_vars>N</replace_vars>
    <parameter>
    </parameter>
     <cluster_schema/>
 <remotesteps>   <input>   </input>   <output>   </output> </remotesteps>    <GUI>
      <xloc>821</xloc>
      <yloc>107</yloc>
      <draw>Y</draw>
      </GUI>
    </step>

  <step>
    <name>FICHERO_TMP_PARA_EMAIL</name>
    <type>TextFileOutput</type>
    <description/>
    <distribute>Y</distribute>
    <copies>1</copies>
         <partitioning>
           <method>none</method>
           <schema_name/>
           </partitioning>
    <separator>;</separator>
    <enclosure>&quot;</enclosure>
    <enclosure_forced>N</enclosure_forced>
    <header>Y</header>
    <footer>N</footer>
    <format>DOS</format>
    <compression>None</compression>
    <encoding/>
    <endedLine/>
    <fileNameInField>N</fileNameInField>
    <fileNameField/>
    <file>
      <name>\datos${hiperusera}\logs\tmp_for_mail</name>
      <is_command>N</is_command>
      <do_not_open_new_file_init>N</do_not_open_new_file_init>
      <extention>txt</extention>
      <append>N</append>
      <split>N</split>
      <haspartno>N</haspartno>
      <add_date>N</add_date>
      <add_time>N</add_time>
      <SpecifyFormat>N</SpecifyFormat>
      <date_time_format/>
      <add_to_result_filenames>Y</add_to_result_filenames>
      <pad>N</pad>
      <fast_dump>N</fast_dump>
      <splitevery>0</splitevery>
    </file>
    <fields>
      <field>
        <name>nombre_fichero_de_tabla</name>
        <type>String</type>
        <format/>
        <currency/>
        <decimal/>
        <group/>
        <nullif/>
        <trim_type>none</trim_type>
        <length>16</length>
        <precision>-1</precision>
      </field>
      <field>
        <name>fecha_tabla</name>
        <type>String</type>
        <format/>
        <currency/>
        <decimal/>
        <group/>
        <nullif/>
        <trim_type>none</trim_type>
        <length>8</length>
        <precision>-1</precision>
      </field>
      <field>
        <name>tienda_tabla</name>
        <type>String</type>
        <format/>
        <currency/>
        <decimal/>
        <group/>
        <nullif/>
        <trim_type>none</trim_type>
        <length>5</length>
        <precision>-1</precision>
      </field>
      <field>
        <name>num_cierre_tabla</name>
        <type>String</type>
        <format/>
        <currency/>
        <decimal/>
        <group/>
        <nullif/>
        <trim_type>none</trim_type>
        <length>4</length>
        <precision>-1</precision>
      </field>
    </fields>
     <cluster_schema/>
 <remotesteps>   <input>   </input>   <output>   </output> </remotesteps>    <GUI>
      <xloc>833</xloc>
      <yloc>785</yloc>
      <draw>Y</draw>
      </GUI>
    </step>

  <step>
    <name>FIN</name>
    <type>Dummy</type>
    <description/>
    <distribute>Y</distribute>
    <copies>1</copies>
         <partitioning>
           <method>none</method>
           <schema_name/>
           </partitioning>
     <cluster_schema/>
 <remotesteps>   <input>   </input>   <output>   </output> </remotesteps>    <GUI>
      <xloc>1124</xloc>
      <yloc>885</yloc>
      <draw>Y</draw>
      </GUI>
    </step>

  <step>
    <name>Inserta Arti</name>
    <type>TableOutput</type>
    <description/>
    <distribute>Y</distribute>
    <copies>1</copies>
         <partitioning>
           <method>none</method>
           <schema_name/>
           </partitioning>
    <connection>datathales</connection>
    <schema>b85139855</schema>
    <table>tmp_filtra_fich_ventas</table>
    <commit>1000</commit>
    <truncate>N</truncate>
    <ignore_errors>N</ignore_errors>
    <use_batch>Y</use_batch>
    <specify_fields>Y</specify_fields>
    <partitioning_enabled>N</partitioning_enabled>
    <partitioning_field/>
    <partitioning_daily>N</partitioning_daily>
    <partitioning_monthly>Y</partitioning_monthly>
    <tablename_in_field>N</tablename_in_field>
    <tablename_field/>
    <tablename_in_table>Y</tablename_in_table>
    <return_keys>N</return_keys>
    <return_field/>
    <fields>
        <field>
          <column_name>nombre_fichero</column_name>
          <stream_name>short_filename</stream_name>
        </field>
        <field>
          <column_name>num_linea_fichero</column_name>
          <stream_name>seq_num_linea_arti</stream_name>
        </field>
        <field>
          <column_name>linea_fichero</column_name>
          <stream_name>linea_fichero</stream_name>
        </field>
        <field>
          <column_name>tienda</column_name>
          <stream_name>extension</stream_name>
        </field>
        <field>
          <column_name>tpv</column_name>
          <stream_name>num_cierre</stream_name>
        </field>
        <field>
          <column_name>fecha</column_name>
          <stream_name>fecha_fichero</stream_name>
        </field>
        <field>
          <column_name>tipo_reg</column_name>
          <stream_name>t_reg</stream_name>
        </field>
    </fields>
     <cluster_schema/>
 <remotesteps>   <input>   </input>   <output>   </output> </remotesteps>    <GUI>
      <xloc>689</xloc>
      <yloc>508</yloc>
      <draw>Y</draw>
      </GUI>
    </step>

  <step>
    <name>Inserta Ofe</name>
    <type>TableOutput</type>
    <description/>
    <distribute>Y</distribute>
    <copies>1</copies>
         <partitioning>
           <method>none</method>
           <schema_name/>
           </partitioning>
    <connection>datathales</connection>
    <schema>b85139855</schema>
    <table>tmp_filtra_fich_ventas</table>
    <commit>1000</commit>
    <truncate>N</truncate>
    <ignore_errors>N</ignore_errors>
    <use_batch>Y</use_batch>
    <specify_fields>Y</specify_fields>
    <partitioning_enabled>N</partitioning_enabled>
    <partitioning_field/>
    <partitioning_daily>N</partitioning_daily>
    <partitioning_monthly>Y</partitioning_monthly>
    <tablename_in_field>N</tablename_in_field>
    <tablename_field/>
    <tablename_in_table>Y</tablename_in_table>
    <return_keys>N</return_keys>
    <return_field/>
    <fields>
        <field>
          <column_name>nombre_fichero</column_name>
          <stream_name>short_filename</stream_name>
        </field>
        <field>
          <column_name>num_linea_fichero</column_name>
          <stream_name>seq_num_linea_ofe</stream_name>
        </field>
        <field>
          <column_name>fecha</column_name>
          <stream_name>fecha_ofe</stream_name>
        </field>
        <field>
          <column_name>linea_fichero</column_name>
          <stream_name>linea_fichero</stream_name>
        </field>
        <field>
          <column_name>tipo_reg</column_name>
          <stream_name>tipo_registro</stream_name>
        </field>
        <field>
          <column_name>tienda</column_name>
          <stream_name>extension</stream_name>
        </field>
        <field>
          <column_name>tpv</column_name>
          <stream_name>tpv_ofe</stream_name>
        </field>
        <field>
          <column_name>nticket</column_name>
          <stream_name>nticket_ofe</stream_name>
        </field>
    </fields>
     <cluster_schema/>
 <remotesteps>   <input>   </input>   <output>   </output> </remotesteps>    <GUI>
      <xloc>504</xloc>
      <yloc>346</yloc>
      <draw>Y</draw>
      </GUI>
    </step>

  <step>
    <name>Inserta Tick</name>
    <type>TableOutput</type>
    <description/>
    <distribute>Y</distribute>
    <copies>1</copies>
         <partitioning>
           <method>none</method>
           <schema_name/>
           </partitioning>
    <connection>datathales</connection>
    <schema>b85139855</schema>
    <table>tmp_filtra_fich_ventas</table>
    <commit>1000</commit>
    <truncate>N</truncate>
    <ignore_errors>N</ignore_errors>
    <use_batch>Y</use_batch>
    <specify_fields>Y</specify_fields>
    <partitioning_enabled>N</partitioning_enabled>
    <partitioning_field/>
    <partitioning_daily>N</partitioning_daily>
    <partitioning_monthly>Y</partitioning_monthly>
    <tablename_in_field>N</tablename_in_field>
    <tablename_field/>
    <tablename_in_table>Y</tablename_in_table>
    <return_keys>N</return_keys>
    <return_field/>
    <fields>
        <field>
          <column_name>nombre_fichero</column_name>
          <stream_name>short_filename</stream_name>
        </field>
        <field>
          <column_name>num_linea_fichero</column_name>
          <stream_name>seq_num_linea_tick</stream_name>
        </field>
        <field>
          <column_name>fecha</column_name>
          <stream_name>fecha_tick</stream_name>
        </field>
        <field>
          <column_name>linea_fichero</column_name>
          <stream_name>linea_fichero</stream_name>
        </field>
        <field>
          <column_name>tipo_reg</column_name>
          <stream_name>tipo_registro</stream_name>
        </field>
        <field>
          <column_name>tienda</column_name>
          <stream_name>extension</stream_name>
        </field>
        <field>
          <column_name>tpv</column_name>
          <stream_name>tpv_tick</stream_name>
        </field>
        <field>
          <column_name>nticket</column_name>
          <stream_name>nticket_tick</stream_name>
        </field>
    </fields>
     <cluster_schema/>
 <remotesteps>   <input>   </input>   <output>   </output> </remotesteps>    <GUI>
      <xloc>636</xloc>
      <yloc>228</yloc>
      <draw>Y</draw>
      </GUI>
    </step>

  <step>
    <name>Insertar en f_ticket_superior_dia</name>
    <type>InsertUpdate</type>
    <description/>
    <distribute>Y</distribute>
    <copies>1</copies>
         <partitioning>
           <method>none</method>
           <schema_name/>
           </partitioning>
    <connection>datathales</connection>
    <commit>1000</commit>
    <update_bypassed>N</update_bypassed>
    <lookup>
      <schema>b85139855</schema>
      <table>f_ticket_superior_dia</table>
      <key>
        <name>fecha_tabla_date</name>
        <field>fecha</field>
        <condition>=</condition>
        <name2/>
      </key>
      <key>
        <name>tienda_tabla</name>
        <field>id_centro</field>
        <condition>=</condition>
        <name2/>
      </key>
      <key>
        <name>tpv_tabla_num</name>
        <field>tpv</field>
        <condition>=</condition>
        <name2/>
      </key>
      <value>
        <name>fecha</name>
        <rename>fecha_tabla_date</rename>
        <update>N</update>
      </value>
      <value>
        <name>id_centro</name>
        <rename>tienda_tabla</rename>
        <update>N</update>
      </value>
      <value>
        <name>tpv</name>
        <rename>tpv_tabla_num</rename>
        <update>N</update>
      </value>
      <value>
        <name>actualizado</name>
        <rename>cero</rename>
        <update>Y</update>
      </value>
      <value>
        <name>data_change_host</name>
        <rename>fecha_ultimo_cambio</rename>
        <update>Y</update>
      </value>
      <value>
        <name>data_change_dtw</name>
        <rename>fecha_ultimo_cambio</rename>
        <update>Y</update>
      </value>
    </lookup>
     <cluster_schema/>
 <remotesteps>   <input>   </input>   <output>   </output> </remotesteps>    <GUI>
      <xloc>1399</xloc>
      <yloc>107</yloc>
      <draw>Y</draw>
      </GUI>
    </step>

  <step>
    <name>LOG_CIERRES_ACUMULADOS</name>
    <type>TextFileOutput</type>
    <description/>
    <distribute>Y</distribute>
    <copies>1</copies>
         <partitioning>
           <method>none</method>
           <schema_name/>
           </partitioning>
    <separator>;</separator>
    <enclosure>&quot;</enclosure>
    <enclosure_forced>N</enclosure_forced>
    <header>Y</header>
    <footer>N</footer>
    <format>DOS</format>
    <compression>None</compression>
    <encoding/>
    <endedLine/>
    <fileNameInField>N</fileNameInField>
    <fileNameField/>
    <file>
      <name>C:\datos\b85139855\logs\LOG_CIERRES_ACUMULADOS_ARTIVEN</name>
      <is_command>N</is_command>
      <do_not_open_new_file_init>N</do_not_open_new_file_init>
      <extention>log</extention>
      <append>Y</append>
      <split>N</split>
      <haspartno>N</haspartno>
      <add_date>N</add_date>
      <add_time>N</add_time>
      <SpecifyFormat>N</SpecifyFormat>
      <date_time_format/>
      <add_to_result_filenames>Y</add_to_result_filenames>
      <pad>N</pad>
      <fast_dump>N</fast_dump>
      <splitevery>0</splitevery>
    </file>
    <fields>
      <field>
        <name>nombre_fichero_de_tabla</name>
        <type>String</type>
        <format/>
        <currency/>
        <decimal/>
        <group/>
        <nullif/>
        <trim_type>none</trim_type>
        <length>16</length>
        <precision>-1</precision>
      </field>
      <field>
        <name>fecha_tabla</name>
        <type>String</type>
        <format/>
        <currency/>
        <decimal/>
        <group/>
        <nullif/>
        <trim_type>none</trim_type>
        <length>8</length>
        <precision>-1</precision>
      </field>
      <field>
        <name>tienda_tabla</name>
        <type>String</type>
        <format/>
        <currency/>
        <decimal/>
        <group/>
        <nullif/>
        <trim_type>none</trim_type>
        <length>5</length>
        <precision>-1</precision>
      </field>
      <field>
        <name>num_cierre_tabla</name>
        <type>String</type>
        <format/>
        <currency/>
        <decimal/>
        <group/>
        <nullif/>
        <trim_type>none</trim_type>
        <length>4</length>
        <precision>-1</precision>
      </field>
    </fields>
     <cluster_schema/>
 <remotesteps>   <input>   </input>   <output>   </output> </remotesteps>    <GUI>
      <xloc>656</xloc>
      <yloc>651</yloc>
      <draw>Y</draw>
      </GUI>
    </step>

  <step>
    <name>Mail</name>
    <type>Mail</type>
    <description/>
    <distribute>Y</distribute>
    <copies>1</copies>
         <partitioning>
           <method>none</method>
           <schema_name/>
           </partitioning>
      <server>smtpServer</server>
      <port>smtpPort</port>
      <destination>dirDestino</destination>
      <destinationCc/>
      <destinationBCc/>
      <replyToAddresses/>
      <replyto>dirOrig</replyto>
      <replytoname>nombreOrig</replytoname>
      <subject>mailSubject</subject>
      <include_date>N</include_date>
      <include_subfolders>N</include_subfolders>
      <zipFilenameDynamic>N</zipFilenameDynamic>
      <isFilenameDynamic>N</isFilenameDynamic>
      <dynamicFieldname/>
      <dynamicWildcard/>
      <dynamicZipFilename/>
      <sourcefilefoldername>C:\datos\b85139855\logs\tmp_for_mail.txt</sourcefilefoldername>
      <sourcewildcard/>
      <contact_person/>
      <contact_phone/>
      <comment/>
      <include_files>N</include_files>
      <zip_files>N</zip_files>
      <zip_name/>
      <zip_limit_size>0</zip_limit_size>
      <use_auth>Y</use_auth>
      <use_secure_auth>Y</use_secure_auth>
      <auth_user>authUsername</auth_user>
      <auth_password>Encrypted 2be98afc86aa7f2e4aa0cba78ee93bcc9</auth_password>
      <only_comment>N</only_comment>
      <use_HTML>Y</use_HTML>
      <use_Priority>N</use_Priority>
    <encoding>UTF-8</encoding>
    <priority>normal</priority>
    <importance>normal</importance>
    <secureconnectiontype>TLS</secureconnectiontype>
      <filetypes>      </filetypes>     <cluster_schema/>
 <remotesteps>   <input>   </input>   <output>   </output> </remotesteps>    <GUI>
      <xloc>1395</xloc>
      <yloc>785</yloc>
      <draw>Y</draw>
      </GUI>
    </step>

  <step>
    <name>OFE</name>
    <type>TextFileInput</type>
    <description/>
    <distribute>N</distribute>
    <copies>1</copies>
         <partitioning>
           <method>none</method>
           <schema_name/>
           </partitioning>
    <accept_filenames>Y</accept_filenames>
    <passing_through_fields>Y</passing_through_fields>
    <accept_field>filename</accept_field>
    <accept_stepname>que_tipo_fichero?</accept_stepname>
    <separator/>
    <enclosure/>
    <enclosure_breaks>N</enclosure_breaks>
    <escapechar/>
    <header>N</header>
    <nr_headerlines>1</nr_headerlines>
    <footer>N</footer>
    <nr_footerlines>1</nr_footerlines>
    <line_wrapped>N</line_wrapped>
    <nr_wraps>1</nr_wraps>
    <layout_paged>N</layout_paged>
    <nr_lines_per_page>80</nr_lines_per_page>
    <nr_lines_doc_header>0</nr_lines_doc_header>
    <noempty>Y</noempty>
    <include>N</include>
    <include_field/>
    <rownum>N</rownum>
    <rownumByFile>N</rownumByFile>
    <rownum_field/>
    <format>DOS</format>
    <encoding/>
    <add_to_result_filenames>Y</add_to_result_filenames>
    <file>
      <name/>
      <filemask/>
      <file_required>N</file_required>
      <name>C:\datos\b85139855\tickets\de_tiendas\ofe20101112.T01</name>
      <filemask/>
      <file_required/>
      <type>Fixed</type>
      <compression>None</compression>
    </file>
    <filters>
      <filter>
        <filter_string>Base64: KioqKg==</filter_string>        <filter_position>-1</filter_position>        <filter_is_last_line>N</filter_is_last_line>        <filter_is_positive>N</filter_is_positive>      </filter>
      <filter>
        <filter_string>Base64: IyMjIw==</filter_string>        <filter_position>-1</filter_position>        <filter_is_last_line>N</filter_is_last_line>        <filter_is_positive>N</filter_is_positive>      </filter>
    </filters>
    <fields>
      <field>
        <name>fecha_ofe</name>
        <type>String</type>
        <format>yyyyMMdd</format>
        <currency/>
        <decimal/>
        <group/>
        <nullif/>
        <ifnull/>
        <position>4</position>
        <length>8</length>
        <precision>-1</precision>
        <trim_type>none</trim_type>
        <repeat>N</repeat>
      </field>
      <field>
        <name>tipo_registro</name>
        <type>String</type>
        <format/>
        <currency/>
        <decimal/>
        <group/>
        <nullif/>
        <ifnull/>
        <position>0</position>
        <length>3</length>
        <precision>-1</precision>
        <trim_type>none</trim_type>
        <repeat>N</repeat>
      </field>
      <field>
        <name>tpv_ofe</name>
        <type>String</type>
        <format>#</format>
        <currency/>
        <decimal/>
        <group/>
        <nullif/>
        <ifnull/>
        <position>23</position>
        <length>4</length>
        <precision>-1</precision>
        <trim_type>none</trim_type>
        <repeat>N</repeat>
      </field>
      <field>
        <name>nticket_ofe</name>
        <type>String</type>
        <format/>
        <currency/>
        <decimal/>
        <group/>
        <nullif/>
        <ifnull/>
        <position>34</position>
        <length>4</length>
        <precision>-1</precision>
        <trim_type>none</trim_type>
        <repeat>N</repeat>
      </field>
      <field>
        <name>linea_fichero</name>
        <type>String</type>
        <format/>
        <currency/>
        <decimal/>
        <group/>
        <nullif/>
        <ifnull/>
        <position>0</position>
        <length>500</length>
        <precision>-1</precision>
        <trim_type>none</trim_type>
        <repeat>N</repeat>
      </field>
    </fields>
    <limit>0</limit>
    <error_ignored>N</error_ignored>
    <error_line_skipped>N</error_line_skipped>
    <error_count_field/>
    <error_fields_field/>
    <error_text_field/>
    <bad_line_files_destination_directory/>
    <bad_line_files_extension>warning</bad_line_files_extension>
    <error_line_files_destination_directory/>
    <error_line_files_extension>error</error_line_files_extension>
    <line_number_files_destination_directory/>
    <line_number_files_extension>line</line_number_files_extension>
    <date_format_lenient>Y</date_format_lenient>
    <date_format_locale>es_es</date_format_locale>
     <cluster_schema/>
 <remotesteps>   <input>   </input>   <output>   </output> </remotesteps>    <GUI>
      <xloc>258</xloc>
      <yloc>346</yloc>
      <draw>Y</draw>
      </GUI>
    </step>

  <step>
    <name>Obtener nombres de fichero</name>
    <type>GetFileNames</type>
    <description/>
    <distribute>Y</distribute>
    <copies>1</copies>
         <partitioning>
           <method>none</method>
           <schema_name/>
           </partitioning>
    <filter>
      <filterfiletype>only_files</filterfiletype>
    </filter>
    <rownum>N</rownum>
    <isaddresult>N</isaddresult>
    <filefield>N</filefield>
    <rownum_field/>
    <filename_Field>path_tickets</filename_Field>
    <wildcard_Field>comodin_tickets</wildcard_Field>
    <limit>0</limit>
    <file>
      <name>${v_path_tickets}</name>
      <filemask>${v_comodin_tickets}</filemask>
      <file_required>N</file_required>
    </file>
     <cluster_schema/>
 <remotesteps>   <input>   </input>   <output>   </output> </remotesteps>    <GUI>
      <xloc>82</xloc>
      <yloc>29</yloc>
      <draw>Y</draw>
      </GUI>
    </step>

  <step>
    <name>Paso de Bloqueo arti</name>
    <type>BlockingStep</type>
    <description/>
    <distribute>N</distribute>
    <copies>1</copies>
         <partitioning>
           <method>none</method>
           <schema_name/>
           </partitioning>
      <pass_all_rows>N</pass_all_rows>
      <directory>%%java.io.tmpdir%%</directory>
      <prefix>block</prefix>
      <cache_size>5000</cache_size>
      <compress>Y</compress>
     <cluster_schema/>
 <remotesteps>   <input>   </input>   <output>   </output> </remotesteps>    <GUI>
      <xloc>833</xloc>
      <yloc>508</yloc>
      <draw>Y</draw>
      </GUI>
    </step>

  <step>
    <name>Paso de Bloqueo ofe</name>
    <type>BlockingStep</type>
    <description/>
    <distribute>N</distribute>
    <copies>1</copies>
         <partitioning>
           <method>none</method>
           <schema_name/>
           </partitioning>
      <pass_all_rows>N</pass_all_rows>
      <directory>%%java.io.tmpdir%%</directory>
      <prefix>block</prefix>
      <cache_size>5000</cache_size>
      <compress>Y</compress>
     <cluster_schema/>
 <remotesteps>   <input>   </input>   <output>   </output> </remotesteps>    <GUI>
      <xloc>626</xloc>
      <yloc>346</yloc>
      <draw>Y</draw>
      </GUI>
    </step>

  <step>
    <name>Paso de Bloqueo para mail</name>
    <type>BlockingStep</type>
    <description/>
    <distribute>N</distribute>
    <copies>1</copies>
         <partitioning>
           <method>none</method>
           <schema_name/>
           </partitioning>
      <pass_all_rows>N</pass_all_rows>
      <directory>%%java.io.tmpdir%%</directory>
      <prefix>block</prefix>
      <cache_size>5000</cache_size>
      <compress>Y</compress>
     <cluster_schema/>
 <remotesteps>   <input>   </input>   <output>   </output> </remotesteps>    <GUI>
      <xloc>988</xloc>
      <yloc>785</yloc>
      <draw>Y</draw>
      </GUI>
    </step>

  <step>
    <name>Paso de Bloqueo tick</name>
    <type>BlockingStep</type>
    <description/>
    <distribute>N</distribute>
    <copies>1</copies>
         <partitioning>
           <method>none</method>
           <schema_name/>
           </partitioning>
      <pass_all_rows>N</pass_all_rows>
      <directory>%%java.io.tmpdir%%</directory>
      <prefix>block</prefix>
      <cache_size>5000</cache_size>
      <compress>Y</compress>
     <cluster_schema/>
 <remotesteps>   <input>   </input>   <output>   </output> </remotesteps>    <GUI>
      <xloc>636</xloc>
      <yloc>107</yloc>
      <draw>Y</draw>
      </GUI>
    </step>

  <step>
    <name>Quito campos que no se usan</name>
    <type>SelectValues</type>
    <description/>
    <distribute>Y</distribute>
    <copies>1</copies>
         <partitioning>
           <method>none</method>
           <schema_name/>
           </partitioning>
    <fields>        <select_unspecified>N</select_unspecified>
      <remove>        <name>type</name>
      </remove>      <remove>        <name>exists</name>
      </remove>      <remove>        <name>ishidden</name>
      </remove>      <remove>        <name>isreadable</name>
      </remove>      <remove>        <name>iswriteable</name>
      </remove>      <remove>        <name>lastmodifiedtime</name>
      </remove>      <remove>        <name>uri</name>
      </remove>      <remove>        <name>rooturi</name>
      </remove>      <remove>        <name>size</name>
      </remove>    </fields>     <cluster_schema/>
 <remotesteps>   <input>   </input>   <output>   </output> </remotesteps>    <GUI>
      <xloc>82</xloc>
      <yloc>124</yloc>
      <draw>Y</draw>
      </GUI>
    </step>

  <step>
    <name>Selecciona&#47;Renombra valores</name>
    <type>SelectValues</type>
    <description/>
    <distribute>N</distribute>
    <copies>1</copies>
         <partitioning>
           <method>none</method>
           <schema_name/>
           </partitioning>
    <fields>        <select_unspecified>N</select_unspecified>
      <meta>        <name>fecha_tabla</name>
        <rename>fecha_tabla_date</rename>
        <type>Date</type>
        <length>-2</length>
        <precision>-2</precision>
        <conversion_mask>yyyyMMdd</conversion_mask>
        <decimal_symbol/>
        <grouping_symbol/>
        <currency_symbol/>
        <storage_type/>
      </meta>      <meta>        <name>tpv_tabla</name>
        <rename>tpv_tabla_num</rename>
        <type>Integer</type>
        <length>-2</length>
        <precision>-2</precision>
        <conversion_mask/>
        <decimal_symbol/>
        <grouping_symbol/>
        <currency_symbol/>
        <storage_type/>
      </meta>    </fields>     <cluster_schema/>
 <remotesteps>   <input>   </input>   <output>   </output> </remotesteps>    <GUI>
      <xloc>1031</xloc>
      <yloc>107</yloc>
      <draw>Y</draw>
      </GUI>
    </step>

  <step>
    <name>Switch &#47; Case</name>
    <type>SwitchCase</type>
    <description/>
    <distribute>N</distribute>
    <copies>1</copies>
         <partitioning>
           <method>none</method>
           <schema_name/>
           </partitioning>
<fieldname>hay_lineas</fieldname>
<use_contains>N</use_contains>
<case_value_type>Integer</case_value_type>
<case_value_format/>
<case_value_decimal/>
<case_value_group/>
<default_target_step>FIN</default_target_step>
<cases><case><value>1</value>
<target_step>Añadir campos mail</target_step>
</case></cases>     <cluster_schema/>
 <remotesteps>   <input>   </input>   <output>   </output> </remotesteps>    <GUI>
      <xloc>1124</xloc>
      <yloc>785</yloc>
      <draw>Y</draw>
      </GUI>
    </step>

  <step>
    <name>TICK</name>
    <type>TextFileInput</type>
    <description/>
    <distribute>N</distribute>
    <copies>1</copies>
         <partitioning>
           <method>none</method>
           <schema_name/>
           </partitioning>
    <accept_filenames>Y</accept_filenames>
    <passing_through_fields>Y</passing_through_fields>
    <accept_field>filename</accept_field>
    <accept_stepname>que_tipo_fichero?</accept_stepname>
    <separator/>
    <enclosure/>
    <enclosure_breaks>N</enclosure_breaks>
    <escapechar/>
    <header>N</header>
    <nr_headerlines>1</nr_headerlines>
    <footer>N</footer>
    <nr_footerlines>1</nr_footerlines>
    <line_wrapped>N</line_wrapped>
    <nr_wraps>1</nr_wraps>
    <layout_paged>N</layout_paged>
    <nr_lines_per_page>80</nr_lines_per_page>
    <nr_lines_doc_header>0</nr_lines_doc_header>
    <noempty>Y</noempty>
    <include>N</include>
    <include_field/>
    <rownum>N</rownum>
    <rownumByFile>N</rownumByFile>
    <rownum_field/>
    <format>DOS</format>
    <encoding/>
    <add_to_result_filenames>Y</add_to_result_filenames>
    <file>
      <name/>
      <filemask/>
      <file_required>N</file_required>
      <type>Fixed</type>
      <compression>None</compression>
    </file>
    <filters>
      <filter>
        <filter_string>Base64: KioqKg==</filter_string>        <filter_position>-1</filter_position>        <filter_is_last_line>N</filter_is_last_line>        <filter_is_positive>N</filter_is_positive>      </filter>
      <filter>
        <filter_string>Base64: IyMjIw==</filter_string>        <filter_position>-1</filter_position>        <filter_is_last_line>N</filter_is_last_line>        <filter_is_positive>N</filter_is_positive>      </filter>
    </filters>
    <fields>
      <field>
        <name>tipo_registro</name>
        <type>String</type>
        <format/>
        <currency/>
        <decimal/>
        <group/>
        <nullif/>
        <ifnull/>
        <position>0</position>
        <length>3</length>
        <precision>-1</precision>
        <trim_type>none</trim_type>
        <repeat>N</repeat>
      </field>
      <field>
        <name>linea_fichero</name>
        <type>String</type>
        <format/>
        <currency/>
        <decimal/>
        <group/>
        <nullif/>
        <ifnull/>
        <position>0</position>
        <length>208</length>
        <precision>-1</precision>
        <trim_type>none</trim_type>
        <repeat>N</repeat>
      </field>
    </fields>
    <limit>0</limit>
    <error_ignored>N</error_ignored>
    <error_line_skipped>N</error_line_skipped>
    <error_count_field/>
    <error_fields_field/>
    <error_text_field/>
    <bad_line_files_destination_directory/>
    <bad_line_files_extension>warning</bad_line_files_extension>
    <error_line_files_destination_directory/>
    <error_line_files_extension>error</error_line_files_extension>
    <line_number_files_destination_directory/>
    <line_number_files_extension>line</line_number_files_extension>
    <date_format_lenient>N</date_format_lenient>
    <date_format_locale>es_es</date_format_locale>
     <cluster_schema/>
 <remotesteps>   <input>   </input>   <output>   </output> </remotesteps>    <GUI>
      <xloc>261</xloc>
      <yloc>125</yloc>
      <draw>Y</draw>
      </GUI>
    </step>

  <step>
    <name>busca_ficheros_ARTI_en_tablas</name>
    <type>DBJoin</type>
    <description/>
    <distribute>N</distribute>
    <copies>1</copies>
         <partitioning>
           <method>none</method>
           <schema_name/>
           </partitioning>
    <connection>datathales</connection>
    <rowlimit>0</rowlimit>
    <sql>select distinct nombre_fichero as nombre_fichero_de_tabla, fecha as fecha_tabla, tienda as tienda_tabla, tpv as num_cierre_tabla  from b85139855.tmp_filtra_fich_ventas 
where tpv not in (select num_cierre_tabla from (select distinct fecha as fecha_tabla, tpv as num_cierre_tabla from b85139855.tmp_filtra_fich_ventas where nombre_fichero like &apos;arti%&apos; and tipo_reg &lt;&gt;&apos;*&apos; order by tpv) as SQ1 group by  num_cierre_tabla having count(fecha_tabla) &gt; 1) 
and nombre_fichero like &apos;arti%&apos; and  tipo_reg &lt;&gt;&apos;*&apos; and substr(fecha,1,4)&lt;&gt;&apos;2009&apos; 
</sql>
    <outer_join>N</outer_join>
    <replace_vars>N</replace_vars>
    <parameter>
    </parameter>
     <cluster_schema/>
 <remotesteps>   <input>   </input>   <output>   </output> </remotesteps>    <GUI>
      <xloc>1004</xloc>
      <yloc>508</yloc>
      <draw>Y</draw>
      </GUI>
    </step>

  <step>
    <name>busca_ficheros_OFE_en_tablas</name>
    <type>DBJoin</type>
    <description/>
    <distribute>N</distribute>
    <copies>1</copies>
         <partitioning>
           <method>none</method>
           <schema_name/>
           </partitioning>
    <connection>datathales</connection>
    <rowlimit>0</rowlimit>
    <sql>select distinct nombre_fichero as nombre_fichero_de_tabla, fecha as fecha_tabla, tienda as tienda_tabla from tmp_filtra_fich_ventas where nombre_fichero like &apos;ofe%&apos;
and substr(fecha,1,4)&lt;&gt;&apos;2009&apos; </sql>
    <outer_join>N</outer_join>
    <replace_vars>N</replace_vars>
    <parameter>
    </parameter>
     <cluster_schema/>
 <remotesteps>   <input>   </input>   <output>   </output> </remotesteps>    <GUI>
      <xloc>810</xloc>
      <yloc>346</yloc>
      <draw>Y</draw>
      </GUI>
    </step>

  <step>
    <name>busca_ficheros_TIC_en_tablas</name>
    <type>DBJoin</type>
    <description/>
    <distribute>N</distribute>
    <copies>1</copies>
         <partitioning>
           <method>none</method>
           <schema_name/>
           </partitioning>
    <connection>datathales</connection>
    <rowlimit>0</rowlimit>
    <sql>select distinct nombre_fichero as nombre_fichero_de_tabla, fecha as fecha_tabla, tienda as tienda_tabla from tmp_filtra_fich_ventas where  nombre_fichero like &apos;tic%&apos; and tipo_reg != &apos;005&apos;
and substr(fecha,1,4)&lt;&gt;&apos;2009&apos; </sql>
    <outer_join>N</outer_join>
    <replace_vars>N</replace_vars>
    <parameter>
    </parameter>
     <cluster_schema/>
 <remotesteps>   <input>   </input>   <output>   </output> </remotesteps>    <GUI>
      <xloc>802</xloc>
      <yloc>230</yloc>
      <draw>Y</draw>
      </GUI>
    </step>

  <step>
    <name>busca_lineas_OFE</name>
    <type>DBJoin</type>
    <description/>
    <distribute>Y</distribute>
    <copies>1</copies>
         <partitioning>
           <method>none</method>
           <schema_name/>
           </partitioning>
    <connection>datathales</connection>
    <rowlimit>0</rowlimit>
    <sql>select  linea_fichero 
from tmp_filtra_fich_ventas 
where nombre_fichero=? and fecha=?  order by num_linea_fichero
</sql>
    <outer_join>N</outer_join>
    <replace_vars>N</replace_vars>
    <parameter>
      <field>
        <name>nombre_fichero_de_tabla</name>
        <type>-</type>
      </field>
      <field>
        <name>fecha_tabla</name>
        <type>-</type>
      </field>
    </parameter>
     <cluster_schema/>
 <remotesteps>   <input>   </input>   <output>   </output> </remotesteps>    <GUI>
      <xloc>1170</xloc>
      <yloc>346</yloc>
      <draw>Y</draw>
      </GUI>
    </step>

  <step>
    <name>busca_lineas_TIC</name>
    <type>DBJoin</type>
    <description/>
    <distribute>Y</distribute>
    <copies>1</copies>
         <partitioning>
           <method>none</method>
           <schema_name/>
           </partitioning>
    <connection>datathales</connection>
    <rowlimit>0</rowlimit>
    <sql>select  linea_fichero 
from tmp_filtra_fich_ventas 
where nombre_fichero=? and (tipo_reg=&apos;005&apos; OR fecha=?)   order by num_linea_fichero</sql>
    <outer_join>N</outer_join>
    <replace_vars>N</replace_vars>
    <parameter>
      <field>
        <name>nombre_fichero_de_tabla</name>
        <type>-</type>
      </field>
      <field>
        <name>fecha_tabla</name>
        <type>-</type>
      </field>
    </parameter>
     <cluster_schema/>
 <remotesteps>   <input>   </input>   <output>   </output> </remotesteps>    <GUI>
      <xloc>1174</xloc>
      <yloc>230</yloc>
      <draw>Y</draw>
      </GUI>
    </step>

  <step>
    <name>busca_lineas_arti</name>
    <type>DBJoin</type>
    <description/>
    <distribute>Y</distribute>
    <copies>1</copies>
         <partitioning>
           <method>none</method>
           <schema_name/>
           </partitioning>
    <connection>datathales</connection>
    <rowlimit>0</rowlimit>
    <sql>select  linea_fichero 
from tmp_filtra_fich_ventas 
where nombre_fichero=? and tpv=? order by num_linea_fichero
</sql>
    <outer_join>N</outer_join>
    <replace_vars>N</replace_vars>
    <parameter>
      <field>
        <name>nombre_fichero_de_tabla</name>
        <type>-</type>
      </field>
      <field>
        <name>num_cierre_tabla</name>
        <type>-</type>
      </field>
    </parameter>
     <cluster_schema/>
 <remotesteps>   <input>   </input>   <output>   </output> </remotesteps>    <GUI>
      <xloc>1292</xloc>
      <yloc>508</yloc>
      <draw>Y</draw>
      </GUI>
    </step>

  <step>
    <name>busca_lineas_arti 2</name>
    <type>DBJoin</type>
    <description/>
    <distribute>Y</distribute>
    <copies>1</copies>
         <partitioning>
           <method>none</method>
           <schema_name/>
           </partitioning>
    <connection>datathales</connection>
    <rowlimit>0</rowlimit>
    <sql>select  linea_fichero 
from tmp_filtra_fich_ventas 
where nombre_fichero=? and tpv=? and (fecha is null or fecha = ?) order by num_linea_fichero
</sql>
    <outer_join>N</outer_join>
    <replace_vars>N</replace_vars>
    <parameter>
      <field>
        <name>nombre_fichero_de_tabla</name>
        <type>-</type>
      </field>
      <field>
        <name>num_cierre_tabla</name>
        <type>-</type>
      </field>
      <field>
        <name>fecha_tabla</name>
        <type>-</type>
      </field>
    </parameter>
     <cluster_schema/>
 <remotesteps>   <input>   </input>   <output>   </output> </remotesteps>    <GUI>
      <xloc>1107</xloc>
      <yloc>651</yloc>
      <draw>Y</draw>
      </GUI>
    </step>

  <step>
    <name>cierres_con_2_fechas_o_mas</name>
    <type>DBJoin</type>
    <description/>
    <distribute>N</distribute>
    <copies>1</copies>
         <partitioning>
           <method>none</method>
           <schema_name/>
           </partitioning>
    <connection>datathales</connection>
    <rowlimit>0</rowlimit>
    <sql>select distinct nombre_fichero as nombre_fichero_de_tabla, fecha as fecha_tabla, tienda as tienda_tabla, tpv as num_cierre_tabla , 1 as hay_lineas from b85139855.tmp_filtra_fich_ventas 
where tpv in (select num_cierre_tabla from (select distinct fecha as fecha_tabla, tpv as num_cierre_tabla from b85139855.tmp_filtra_fich_ventas where nombre_fichero like &apos;arti%&apos; and tipo_reg &lt;&gt;&apos;*&apos; order by tpv) as SQ1 group by  num_cierre_tabla having count(fecha_tabla) &gt; 1)
and nombre_fichero like &apos;arti%&apos; and  tipo_reg &lt;&gt;&apos;*&apos; ORDER BY tpv
</sql>
    <outer_join>N</outer_join>
    <replace_vars>N</replace_vars>
    <parameter>
    </parameter>
     <cluster_schema/>
 <remotesteps>   <input>   </input>   <output>   </output> </remotesteps>    <GUI>
      <xloc>833</xloc>
      <yloc>651</yloc>
      <draw>Y</draw>
      </GUI>
    </step>

  <step>
    <name>creo_campo_tipo_fichero</name>
    <type>StringCut</type>
    <description/>
    <distribute>Y</distribute>
    <copies>1</copies>
         <partitioning>
           <method>none</method>
           <schema_name/>
           </partitioning>
    <fields>
      <field>
        <in_stream_name>short_filename</in_stream_name>
        <out_stream_name>tipo_fichero</out_stream_name>
        <cut_from>0</cut_from>
        <cut_to>3</cut_to>
      </field>
    </fields>
     <cluster_schema/>
 <remotesteps>   <input>   </input>   <output>   </output> </remotesteps>    <GUI>
      <xloc>81</xloc>
      <yloc>219</yloc>
      <draw>Y</draw>
      </GUI>
    </step>

  <step>
    <name>creo_rutas_ficheros_arti</name>
    <type>ScriptValueMod</type>
    <description/>
    <distribute>N</distribute>
    <copies>1</copies>
         <partitioning>
           <method>none</method>
           <schema_name/>
           </partitioning>
    <compatible>Y</compatible>
    <jsScripts>      <jsScript>        <jsScript_type>0</jsScript_type>
        <jsScript_name>Script 1</jsScript_name>
        <jsScript_script>&#47;&#47;Script here

&#47;&#47;var fichero_incorporar_2 = directorio_si_fecha_mayor.getString()+nombre_fichero_de_tabla.getString()
&#47;&#47;var fichero_checkear_2 = directorio_si_otra_fecha.getString()+nombre_fichero_de_tabla.getString()

var fichero_incorporar_2 = getVariable(&quot;v_path_incorporar&quot;,&quot;no_encontrada_v_path_incorporar&quot;)+ &apos;arti&apos; + fecha_tabla.getString() + &apos;.&apos; + tienda_tabla.getString()
&#47;&#47;var fichero_checkear_2 = directorio_si_otra_fecha.getString()+nombre_fichero_de_tabla.getString()</jsScript_script>
      </jsScript>    </jsScripts>    <fields>      <field>        <name>fichero_incorporar_2</name>
        <rename>fichero_incorporar_2</rename>
        <type>String</type>
        <length>-1</length>
        <precision>-1</precision>
        <replace>N</replace>
      </field>    </fields>     <cluster_schema/>
 <remotesteps>   <input>   </input>   <output>   </output> </remotesteps>    <GUI>
      <xloc>1162</xloc>
      <yloc>508</yloc>
      <draw>Y</draw>
      </GUI>
    </step>

  <step>
    <name>creo_rutas_ficheros_arti 2</name>
    <type>ScriptValueMod</type>
    <description/>
    <distribute>N</distribute>
    <copies>1</copies>
         <partitioning>
           <method>none</method>
           <schema_name/>
           </partitioning>
    <compatible>Y</compatible>
    <jsScripts>      <jsScript>        <jsScript_type>0</jsScript_type>
        <jsScript_name>Script 1</jsScript_name>
        <jsScript_script>&#47;&#47;Script here

&#47;&#47;var fichero_incorporar_2 = directorio_si_fecha_mayor.getString()+nombre_fichero_de_tabla.getString()
&#47;&#47;var fichero_checkear_2 = directorio_si_otra_fecha.getString()+nombre_fichero_de_tabla.getString()

var fichero_incorporar_2 = getVariable(&quot;v_path_incorporar&quot;,&quot;no_encontrada_v_path_incorporar&quot;)+ &apos;arti&apos; + fecha_tabla.getString() + &apos;.&apos; + tienda_tabla.getString()
&#47;&#47;var fichero_checkear_2 = directorio_si_otra_fecha.getString()+nombre_fichero_de_tabla.getString()</jsScript_script>
      </jsScript>    </jsScripts>    <fields>      <field>        <name>fichero_incorporar_2</name>
        <rename>fichero_incorporar_2</rename>
        <type>String</type>
        <length>-1</length>
        <precision>-1</precision>
        <replace>N</replace>
      </field>    </fields>     <cluster_schema/>
 <remotesteps>   <input>   </input>   <output>   </output> </remotesteps>    <GUI>
      <xloc>977</xloc>
      <yloc>651</yloc>
      <draw>Y</draw>
      </GUI>
    </step>

  <step>
    <name>creo_rutas_ficheros_ofe</name>
    <type>ScriptValueMod</type>
    <description/>
    <distribute>N</distribute>
    <copies>1</copies>
         <partitioning>
           <method>none</method>
           <schema_name/>
           </partitioning>
    <compatible>Y</compatible>
    <jsScripts>      <jsScript>        <jsScript_type>0</jsScript_type>
        <jsScript_name>Script 1</jsScript_name>
        <jsScript_script>&#47;&#47;Script here

&#47;&#47;var fichero_incorporar_2 = directorio_si_fecha_mayor.getString()+nombre_fichero_de_tabla.getString()
&#47;&#47;var fichero_checkear_2 = directorio_si_otra_fecha.getString()+nombre_fichero_de_tabla.getString()

var fichero_incorporar_2 = getVariable(&quot;v_path_incorporar&quot;,&quot;no_encontrada_v_path_incorporar&quot;)+ &apos;ofe&apos; + fecha_tabla.getString() + &apos;.&apos; + tienda_tabla.getString()
&#47;&#47;var fichero_checkear_2 = directorio_si_otra_fecha.getString()+nombre_fichero_de_tabla.getString()</jsScript_script>
      </jsScript>    </jsScripts>    <fields>      <field>        <name>fichero_incorporar_2</name>
        <rename>fichero_incorporar_2</rename>
        <type>String</type>
        <length>-1</length>
        <precision>-1</precision>
        <replace>N</replace>
      </field>    </fields>     <cluster_schema/>
 <remotesteps>   <input>   </input>   <output>   </output> </remotesteps>    <GUI>
      <xloc>982</xloc>
      <yloc>346</yloc>
      <draw>Y</draw>
      </GUI>
    </step>

  <step>
    <name>creo_rutas_ficheros_tic</name>
    <type>ScriptValueMod</type>
    <description/>
    <distribute>N</distribute>
    <copies>1</copies>
         <partitioning>
           <method>none</method>
           <schema_name/>
           </partitioning>
    <compatible>Y</compatible>
    <jsScripts>      <jsScript>        <jsScript_type>0</jsScript_type>
        <jsScript_name>Script 1</jsScript_name>
        <jsScript_script>&#47;&#47;Script here

&#47;&#47;var fichero_incorporar_2 = directorio_si_fecha_mayor.getString()+nombre_fichero_de_tabla.getString()
&#47;&#47;var fichero_checkear_2 = directorio_si_otra_fecha.getString()+nombre_fichero_de_tabla.getString()

var fichero_incorporar_2 = getVariable(&quot;v_path_incorporar&quot;,&quot;no_encontrada_v_path_incorporar&quot;)+ &apos;tick&apos; + fecha_tabla.getString() + &apos;.&apos; + tienda_tabla.getString()
&#47;&#47;var fichero_checkear_2 = directorio_si_otra_fecha.getString()+nombre_fichero_de_tabla.getString()</jsScript_script>
      </jsScript>    </jsScripts>    <fields>      <field>        <name>fichero_incorporar_2</name>
        <rename>fichero_incorporar_2</rename>
        <type>String</type>
        <length>-1</length>
        <precision>-1</precision>
        <replace>N</replace>
      </field>    </fields>     <cluster_schema/>
 <remotesteps>   <input>   </input>   <output>   </output> </remotesteps>    <GUI>
      <xloc>985</xloc>
      <yloc>230</yloc>
      <draw>Y</draw>
      </GUI>
    </step>

  <step>
    <name>fecha_ultimo_cambio</name>
    <type>ScriptValueMod</type>
    <description/>
    <distribute>Y</distribute>
    <copies>1</copies>
         <partitioning>
           <method>none</method>
           <schema_name/>
           </partitioning>
    <compatible>N</compatible>
    <jsScripts>      <jsScript>        <jsScript_type>0</jsScript_type>
        <jsScript_name>Script 1</jsScript_name>
        <jsScript_script>&#47;&#47;Script here

var fecha_ultimo_cambio=str2date(trim(getVariable(&quot;v_ultimo_cambio&quot;,null)),&quot;yyyy&#47;MM&#47;dd HH:mm:ss.SSS&quot;)</jsScript_script>
      </jsScript>    </jsScripts>    <fields>      <field>        <name>fecha_ultimo_cambio</name>
        <rename>fecha_ultimo_cambio</rename>
        <type>Date</type>
        <length>-1</length>
        <precision>-1</precision>
        <replace>N</replace>
      </field>    </fields>     <cluster_schema/>
 <remotesteps>   <input>   </input>   <output>   </output> </remotesteps>    <GUI>
      <xloc>1217</xloc>
      <yloc>107</yloc>
      <draw>Y</draw>
      </GUI>
    </step>

  <step>
    <name>fichero_a_incorporar</name>
    <type>TextFileOutput</type>
    <description/>
    <distribute>Y</distribute>
    <copies>1</copies>
         <partitioning>
           <method>none</method>
           <schema_name/>
           </partitioning>
    <separator/>
    <enclosure/>
    <enclosure_forced>N</enclosure_forced>
    <header>Y</header>
    <footer>N</footer>
    <format>DOS</format>
    <compression>None</compression>
    <encoding/>
    <endedLine/>
    <fileNameInField>Y</fileNameInField>
    <fileNameField>fichero_incorporar_2</fileNameField>
    <file>
      <name>C:\tickets\debug</name>
      <is_command>N</is_command>
      <do_not_open_new_file_init>N</do_not_open_new_file_init>
      <extention/>
      <append>Y</append>
      <split>N</split>
      <haspartno>N</haspartno>
      <add_date>N</add_date>
      <add_time>N</add_time>
      <SpecifyFormat>N</SpecifyFormat>
      <date_time_format/>
      <add_to_result_filenames>Y</add_to_result_filenames>
      <pad>N</pad>
      <fast_dump>N</fast_dump>
      <splitevery>0</splitevery>
    </file>
    <fields>
      <field>
        <name>linea_fichero_1</name>
        <type>String</type>
        <format/>
        <currency/>
        <decimal/>
        <group/>
        <nullif/>
        <trim_type>right</trim_type>
        <length>260</length>
        <precision>-1</precision>
      </field>
    </fields>
     <cluster_schema/>
 <remotesteps>   <input>   </input>   <output>   </output> </remotesteps>    <GUI>
      <xloc>1416</xloc>
      <yloc>508</yloc>
      <draw>Y</draw>
      </GUI>
    </step>

  <step>
    <name>fichero_a_incorporar 2</name>
    <type>TextFileOutput</type>
    <description/>
    <distribute>Y</distribute>
    <copies>1</copies>
         <partitioning>
           <method>none</method>
           <schema_name/>
           </partitioning>
    <separator/>
    <enclosure/>
    <enclosure_forced>N</enclosure_forced>
    <header>Y</header>
    <footer>N</footer>
    <format>DOS</format>
    <compression>None</compression>
    <encoding/>
    <endedLine/>
    <fileNameInField>Y</fileNameInField>
    <fileNameField>fichero_incorporar_2</fileNameField>
    <file>
      <name>C:\tickets\debug</name>
      <is_command>N</is_command>
      <do_not_open_new_file_init>N</do_not_open_new_file_init>
      <extention/>
      <append>Y</append>
      <split>N</split>
      <haspartno>N</haspartno>
      <add_date>N</add_date>
      <add_time>N</add_time>
      <SpecifyFormat>N</SpecifyFormat>
      <date_time_format/>
      <add_to_result_filenames>Y</add_to_result_filenames>
      <pad>N</pad>
      <fast_dump>N</fast_dump>
      <splitevery>0</splitevery>
    </file>
    <fields>
      <field>
        <name>linea_fichero_1</name>
        <type>String</type>
        <format/>
        <currency/>
        <decimal/>
        <group/>
        <nullif/>
        <trim_type>right</trim_type>
        <length>260</length>
        <precision>-1</precision>
      </field>
    </fields>
     <cluster_schema/>
 <remotesteps>   <input>   </input>   <output>   </output> </remotesteps>    <GUI>
      <xloc>1231</xloc>
      <yloc>651</yloc>
      <draw>Y</draw>
      </GUI>
    </step>

  <step>
    <name>fichero_a_incorporar_OFE</name>
    <type>TextFileOutput</type>
    <description/>
    <distribute>Y</distribute>
    <copies>1</copies>
         <partitioning>
           <method>none</method>
           <schema_name/>
           </partitioning>
    <separator/>
    <enclosure/>
    <enclosure_forced>N</enclosure_forced>
    <header>Y</header>
    <footer>N</footer>
    <format>DOS</format>
    <compression>None</compression>
    <encoding/>
    <endedLine/>
    <fileNameInField>Y</fileNameInField>
    <fileNameField>fichero_incorporar_2</fileNameField>
    <file>
      <name>C:\tickets\debug</name>
      <is_command>N</is_command>
      <do_not_open_new_file_init>N</do_not_open_new_file_init>
      <extention/>
      <append>Y</append>
      <split>N</split>
      <haspartno>N</haspartno>
      <add_date>N</add_date>
      <add_time>N</add_time>
      <SpecifyFormat>N</SpecifyFormat>
      <date_time_format/>
      <add_to_result_filenames>Y</add_to_result_filenames>
      <pad>N</pad>
      <fast_dump>N</fast_dump>
      <splitevery>0</splitevery>
    </file>
    <fields>
      <field>
        <name>linea_fichero_1</name>
        <type>String</type>
        <format/>
        <currency/>
        <decimal/>
        <group/>
        <nullif/>
        <trim_type>none</trim_type>
        <length>136</length>
        <precision>-1</precision>
      </field>
    </fields>
     <cluster_schema/>
 <remotesteps>   <input>   </input>   <output>   </output> </remotesteps>    <GUI>
      <xloc>1352</xloc>
      <yloc>346</yloc>
      <draw>Y</draw>
      </GUI>
    </step>

  <step>
    <name>fichero_a_incorporar_TIC</name>
    <type>TextFileOutput</type>
    <description/>
    <distribute>Y</distribute>
    <copies>1</copies>
         <partitioning>
           <method>none</method>
           <schema_name/>
           </partitioning>
    <separator/>
    <enclosure/>
    <enclosure_forced>N</enclosure_forced>
    <header>Y</header>
    <footer>N</footer>
    <format>DOS</format>
    <compression>None</compression>
    <encoding/>
    <endedLine/>
    <fileNameInField>Y</fileNameInField>
    <fileNameField>fichero_incorporar_2</fileNameField>
    <file>
      <name>C:\tickets\debug</name>
      <is_command>N</is_command>
      <do_not_open_new_file_init>N</do_not_open_new_file_init>
      <extention/>
      <append>Y</append>
      <split>N</split>
      <haspartno>N</haspartno>
      <add_date>N</add_date>
      <add_time>N</add_time>
      <SpecifyFormat>N</SpecifyFormat>
      <date_time_format/>
      <add_to_result_filenames>Y</add_to_result_filenames>
      <pad>N</pad>
      <fast_dump>N</fast_dump>
      <splitevery>0</splitevery>
    </file>
    <fields>
      <field>
        <name>linea_fichero_1</name>
        <type>String</type>
        <format/>
        <currency/>
        <decimal/>
        <group/>
        <nullif/>
        <trim_type>none</trim_type>
        <length>209</length>
        <precision>-1</precision>
      </field>
    </fields>
     <cluster_schema/>
 <remotesteps>   <input>   </input>   <output>   </output> </remotesteps>    <GUI>
      <xloc>1365</xloc>
      <yloc>232</yloc>
      <draw>Y</draw>
      </GUI>
    </step>

  <step>
    <name>prepara_campos_arti</name>
    <type>ScriptValueMod</type>
    <description/>
    <distribute>N</distribute>
    <copies>1</copies>
         <partitioning>
           <method>none</method>
           <schema_name/>
           </partitioning>
    <compatible>N</compatible>
    <jsScripts>      <jsScript>        <jsScript_type>0</jsScript_type>
        <jsScript_name>Script 1</jsScript_name>
        <jsScript_script>&#47;&#47;Script here

&#47;&#47;var num_cierre = 0;
var fecha_fichero = &apos;&apos;;
var t_reg=&apos;*&apos;

if (substr(linea_fichero,0,1)==&apos;*&apos;) &#47;&#47; Comienzo de cierre nuevo
{
	if (num_cierre &gt;= 0)
	{
		num_cierre = num_cierre + 1;
	}
	else
	{	
		var num_cierre = 0;
	}

} else if (substr(linea_fichero,0,1)==&apos;=&apos;) &#47;&#47; Lineas con fecha
{
	if ((str2num(substr(linea_fichero,1,3))==10 ))
	{
		switch (str2num(substr(linea_fichero,5,3)))
		{
			case 1:
				if (substr(linea_fichero,5,1)==&apos;0&apos;){
					fecha_fichero=substr(linea_fichero,104,8);		
					t_reg=&apos;001&apos;;	
				}
				break;	

			case 7:
				if (substr(linea_fichero,5,1)==&apos;0&apos;){
					fecha_fichero=substr(linea_fichero,68,8);			
					t_reg=&apos;007&apos;;
				}
				break;	
			case 14:
				if (substr(linea_fichero,5,1)==&apos;0&apos;){
					fecha_fichero=substr(linea_fichero,46,8);			
					t_reg=&apos;014&apos;;
				}
				break;	
		}
	}
}

</jsScript_script>
      </jsScript>    </jsScripts>    <fields>      <field>        <name>num_cierre</name>
        <rename>num_cierre</rename>
        <type>Number</type>
        <length>16</length>
        <precision>0</precision>
        <replace>N</replace>
      </field>      <field>        <name>fecha_fichero</name>
        <rename>fecha_fichero</rename>
        <type>String</type>
        <length>8</length>
        <precision>-1</precision>
        <replace>N</replace>
      </field>      <field>        <name>t_reg</name>
        <rename>t_reg</rename>
        <type>String</type>
        <length>3</length>
        <precision>-1</precision>
        <replace>N</replace>
      </field>    </fields>     <cluster_schema/>
 <remotesteps>   <input>   </input>   <output>   </output> </remotesteps>    <GUI>
      <xloc>555</xloc>
      <yloc>508</yloc>
      <draw>Y</draw>
      </GUI>
    </step>

  <step>
    <name>prepara_campos_segun_tipo_registro</name>
    <type>ScriptValueMod</type>
    <description/>
    <distribute>N</distribute>
    <copies>1</copies>
         <partitioning>
           <method>none</method>
           <schema_name/>
           </partitioning>
    <compatible>N</compatible>
    <jsScripts>      <jsScript>        <jsScript_type>0</jsScript_type>
        <jsScript_name>Script 1</jsScript_name>
        <jsScript_script>&#47;&#47;Script here

var fecha_tick;
var nticket_tick=&apos;&apos;;
var tpv_tick=&apos;&apos;;

switch (str2num(tipo_registro))
{
	case 1:
&#47;&#47;		fecha_tick=fecha_reg_001;
		fecha_tick=substr(linea_fichero,146,8);

&#47;&#47;		nticket_tick=nticket_reg_001;
		nticket_tick=substr(linea_fichero,15,4);

&#47;&#47;      tpv_tick=tpv_reg_001;
        tpv_tick=substr(linea_fichero,7,4);
	break;	

	case 2:
&#47;&#47;		fecha_tick=fecha_reg_002;
		fecha_tick=substr(linea_fichero,90,8);;
		nticket_tick=substr(linea_fichero,19,4);
	break;

	case 5:
&#47;&#47;		fecha_tick=fecha_reg_005;
		fecha_tick=substr(linea_fichero,40,8);
	break;

	default: &#47;&#47; 010 o 011
&#47;&#47;		fecha_tick=fecha_reg_010_011;
		fecha_tick=substr(linea_fichero,4,8);;

&#47;&#47;		nticket_tick=nticket_reg_010_011;
		nticket_tick=substr(linea_fichero,34,4);;
		tpv_tick=substr(linea_fichero,23,4);
}

</jsScript_script>
      </jsScript>    </jsScripts>    <fields>      <field>        <name>fecha_tick</name>
        <rename>fecha_tick</rename>
        <type>String</type>
        <length>-1</length>
        <precision>-1</precision>
        <replace>N</replace>
      </field>      <field>        <name>nticket_tick</name>
        <rename>nticket_tick</rename>
        <type>String</type>
        <length>5</length>
        <precision>-1</precision>
        <replace>N</replace>
      </field>      <field>        <name>tpv_tick</name>
        <rename>tpv_tick</rename>
        <type>String</type>
        <length>4</length>
        <precision>-1</precision>
        <replace>N</replace>
      </field>    </fields>     <cluster_schema/>
 <remotesteps>   <input>   </input>   <output>   </output> </remotesteps>    <GUI>
      <xloc>452</xloc>
      <yloc>228</yloc>
      <draw>Y</draw>
      </GUI>
    </step>

  <step>
    <name>que_tipo_fichero?</name>
    <type>SwitchCase</type>
    <description/>
    <distribute>N</distribute>
    <copies>1</copies>
         <partitioning>
           <method>none</method>
           <schema_name/>
           </partitioning>
<fieldname>tipo_fichero</fieldname>
<use_contains>N</use_contains>
<case_value_type>String</case_value_type>
<case_value_format/>
<case_value_decimal/>
<case_value_group/>
<default_target_step/>
<cases><case><value>tic</value>
<target_step>TICK</target_step>
</case><case><value>ofe</value>
<target_step>OFE</target_step>
</case><case><value>art</value>
<target_step>ARTI</target_step>
</case></cases>     <cluster_schema/>
 <remotesteps>   <input>   </input>   <output>   </output> </remotesteps>    <GUI>
      <xloc>81</xloc>
      <yloc>345</yloc>
      <draw>Y</draw>
      </GUI>
    </step>

  <step>
    <name>secuencia_fichero_arti</name>
    <type>Sequence</type>
    <description/>
    <distribute>N</distribute>
    <copies>1</copies>
         <partitioning>
           <method>none</method>
           <schema_name/>
           </partitioning>
      <valuename>seq_num_linea_arti</valuename>
      <use_database>N</use_database>
      <connection/>
      <schema/>
      <seqname>SEQ_</seqname>
      <use_counter>Y</use_counter>
      <counter_name/>
      <start_at>1</start_at>
      <increment_by>1</increment_by>
      <max_value>999999999</max_value>
     <cluster_schema/>
 <remotesteps>   <input>   </input>   <output>   </output> </remotesteps>    <GUI>
      <xloc>405</xloc>
      <yloc>508</yloc>
      <draw>Y</draw>
      </GUI>
    </step>

  <step>
    <name>secuencia_fichero_ofe</name>
    <type>Sequence</type>
    <description/>
    <distribute>N</distribute>
    <copies>1</copies>
         <partitioning>
           <method>none</method>
           <schema_name/>
           </partitioning>
      <valuename>seq_num_linea_ofe</valuename>
      <use_database>N</use_database>
      <connection/>
      <schema/>
      <seqname>SEQ_</seqname>
      <use_counter>Y</use_counter>
      <counter_name/>
      <start_at>1</start_at>
      <increment_by>1</increment_by>
      <max_value>999999999</max_value>
     <cluster_schema/>
 <remotesteps>   <input>   </input>   <output>   </output> </remotesteps>    <GUI>
      <xloc>369</xloc>
      <yloc>346</yloc>
      <draw>Y</draw>
      </GUI>
    </step>

  <step>
    <name>secuencia_fichero_tick</name>
    <type>Sequence</type>
    <description/>
    <distribute>N</distribute>
    <copies>1</copies>
         <partitioning>
           <method>none</method>
           <schema_name/>
           </partitioning>
      <valuename>seq_num_linea_tick</valuename>
      <use_database>N</use_database>
      <connection/>
      <schema/>
      <seqname>SEQ_</seqname>
      <use_counter>Y</use_counter>
      <counter_name/>
      <start_at>1</start_at>
      <increment_by>1</increment_by>
      <max_value>999999999</max_value>
     <cluster_schema/>
 <remotesteps>   <input>   </input>   <output>   </output> </remotesteps>    <GUI>
      <xloc>453</xloc>
      <yloc>125</yloc>
      <draw>Y</draw>
      </GUI>
    </step>

  <step_error_handling>
  </step_error_handling>
   <slave-step-copy-partition-distribution>
</slave-step-copy-partition-distribution>
   <slave_transformation>N</slave_transformation>
</transformation>
